"""
Snakemake pipeline for APAlyzer.
For help see: https://snakemake.readthedocs.io/en/stable/index.html.
"""

import pandas as pd
import os


samples = pd.read_csv(config["samples"]).set_index("sample", drop=False)

LOG_DIR = os.path.join(config["out_dir"], config["logs_subdir"],"")

include: "rules/genome_preprocessing.smk"
include: "rules/quantification.smk"
include: "rules/differential_usage.smk"

#-------------------------------------------------------------------------------
localrules: finish
print(list(set(samples.bam.values)))
rule finish:
    """Rule that specifies the final output."""
    input:
        diff_usage = expand(os.path.join(config["out_dir"],"{experiment}_differential_usage_APAlyzer.csv"),
            experiment=list(set(samples.experiment.values)))


#-------------------------------------------------------------------------------
# How did it go?
#-------------------------------------------------------------------------------
onsuccess:
    print("Workflow finished, no error")

onerror:
    print("An error occurred, check log at %s." % {log})